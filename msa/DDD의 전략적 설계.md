# DDD의 전략적 설계

- DDD의 전략적 설계에서는 비즈니스 응집성이 있는 컨텍스트를 구분하고, 이를 바운디드 컨텍스트라 하는데 이 단위가 마이크로서비스를 식별하기 위한 훌륭한 단위가 됨.
- 또한 전략적 설계를 통해 식별된 마이크로서비스의 내부 구조를 정의하고 상세히 설계하기 위해 DDD의 객체 설계 기법인 전술적 설계를 사용할 수 있음.

## 도메인과 서브도메인

- DDD에서는 하나의 큰 도메인을 전략적 중요도에 따라 도메인을 나누고, 각 도메인을 각각 해결하는 방법을 기본으로 함. 이렇게 분리된 도메인을 서브도메인이라고 함.
- 서비도메인은 중요도에 따라 핵심 서브도메인, 지원 서브도메인, 일반 서브도메인의 세 가지 유형으로 나뉨.
  - 핵심 서브도메인은 프로젝트 목록에서 높은 우선순위를 갖는 영역이자 소프트웨어 개발에서 전략적으로 가장 큰 투자가 필요한 영역.
  - 지원 서브도메인은 비즈니스에 필수적이지만 핵심은 아닌 부분으로, 핵심 도메인을 성공시키기 위해서 필요한 영역.
  - 일반 서브도메인은 비즈니스적으로 특화된 부분은 아니지만 전체 비즈니스 솔루션에 필요한 부분.

## 유비쿼터스 언어와 도메인 모델, 바운디드 컨텍스트

- DDD에서 특정 도메인에서의 의도를 명확히 반영하고 도메인 핵심 개념을 잘 전달할 수 있는 언어를 유비쿼터스 언어라고 함.
- 유비쿼터스 언어를 정의해서 이해관계자가 모두 공통의 언어를 사용하면 고객, 설계자, 개발자까지 용어에 따른 오해를 없앨 수 있게 됨.
- 예전에 데이터 모델링에서 사용했던 표준 단어/용어 사전과는 다른 개념으로, 표준 단어/용어가 특정 프로젝트나 전체 시스템에서 하향식으로 규정됐던 개념이었다면 유비쿼터스 언어는 그보다 작은 단위의 세부 도메인에 특정 업무와 관련된 사람들 간에 자율적으로 정의되고 통용되는 개념을 나타냄.
- 도메인에 특화된 개념이 유비쿼터스 언어로 정의되고, 이 개념들은 서로 관계를 맺는데, 이 같은 관계를 표현한 모델을 도메인 모델이라고 함.

![도메인 모델과 바운디드 컨텍스트](https://engineering-skcc.github.io/assets/images/msa/MSA5.4.png)

- 도메인 모델들을 구성하다 보면 각 도메인 모델과 다른 도메인 모델 간의 경계가 생기는데 이 경계가 바로 도메인의 경계, 바운디드 컨텍스트.
- 도메인 모델은 도메인과 관련된 업무를 수행하는 제품 책임자, 도메인 전문가, 개발자를 비롯한 모든 구성원들이 업무를 이해하는 기본 모형이 됨.

## 컨텍스트 매핑

- 바운디드 컨텍스트를 식별할 때 각 컨텍스트는 내부적으로 응집성이 높고, 다른 컨텍스트와는 의존관계가 낮아야 한다는 원칙하에 설계함.
- 하나의 큰 도메인을 여러 개의 바운디드 컨텍스트로 식별하면 비즈니스 수행을 위해 여러 개의 컨텍스트가 연계해야 하는 경우가 발생하는데, 이러한 컨텍스트 간의 의존 관계를 DDD에서는 컨텍스트 매핑이라 하고, 연관관계에 있는 두 컨텍스트 사이에 선을 그려서 표시함.
- 시스템을 구성하는 컨텍스트 간의 매핑 관계를 표시한 다이어그램을 컨텍스트 맵이라고 함. 컨텍스트 맵을 그리려면 다양한 컨텍스트 매핑 패턴을 이해해야 함

## 주요 컨텍스트 매핑 관계

### 공유 커널(Shared Kernel)

- 바운디드 컨텍스트 사이에 공통적인 모델을 공유하는 관계.
- 두 개 이상의 팀에서 작지만 공통의 모델을 공유하는 관계.
- 각 팀은 공유하는 모델에 서로 합의해야 함.
- 이 부분이 변경되면 여러 관련 컨텍스트에 영향을 미치므로 공유하는 모델의 코드 빌드를 관리하고 테스트하는 것은 한 팀이 맡아 수행해야 함.

![공유 커널](https://engineering-skcc.github.io/assets/images/msa/MSA5.5.png)

### 소비자와 공급자(Customer-Supplier)

- 공급하는 컨텍스트는 상류(upstream)로, 소비하는 컨텍스트는 하류(downstream)로 표시.
- 데이터의 흐름은 상류에서 하류로 흐름.
- 상류에 변화가 있으면 하류에서 변화를 따라야 하며, 공급자는 소비자가 원하는 기능을 제공해야 함.
  ![컨텍스트 매핑](https://engineering-skcc.github.io/assets/images/msa/MSA5.6.png)

### 준수자(Confirmist)

- 소비자와 공급자와 유사하지만 상류 팀이 하류 팀의 요구를 지원하지 않거나 못하는 경우 사용.
- 이런 상황에서 하류팀은 상류팀이 제공하는 모델을 그대로 사용.

### 충돌 방지 계층(ACL; Anti-Corruption Layer)

- 하류 팀이 상류 팀의 모델에 영향을 받을 때 하류 팀의 고유 모델을 지키기 위한 번역 계층을 만드는 것.
- 이 게층은 둘 사이의 차이를 번역하며, 하류 모델의 독립성을 유지함.
- 이러한 매핑 유형은 클라우드 기반 마이크로서비스 아키텍처를 적용하는 새로운 시스템을 레거시 시스템과 통합하기 위해 주로 사용됨.
- 레거시 시스템 전체를 마이크로서비스 환경으로 변경하는 위험을 줄이고자 하는 단계적 전환 방식 방식에 많이 사용됨.

![충돌 방지 계층](https://engineering-skcc.github.io/assets/images/msa/MSA5.7.png)

### 공개 호스트 서비스(OHS; Open Host Service)

- 바운디드 컨텍스트에 대한 접근을 제공하는 프로토콜이나 인터페이스를 정의.
- 하류의 컨텍스트가 상위 컨텍스트에서 제공하는 기능을 용이하게 사용할 수 있도록 공개되어 있음.
- 다른 컨텍스트에서 사용할 수 있는 공유된 API가 여기에 해당.

![공개 호스트 서비스](https://engineering-skcc.github.io/assets/images/msa/MSA5.8.png)

### 발행된 언어

- 하류의 컨텍스트가 상류 컨텍스트가 제공하는 기능을 사용하기 위한 간단한 사용과 번역을 가능케 하는 문서화된 정보 교환 언어. XML이나 JSON 스키마로 표현될 수 있으며, 주로 공개 호스트 서비스와 짝을 이뤄 사용됨.

![발행된 언어](https://engineering-skcc.github.io/assets/images/msa/MSA5.9.png)

## 컨텍스트 맵

- 하나의 큰 도메인을 여러 개의 바운디드 컨텍스트로 식별하고 이들 간의 관계를 표현한 그림을 컨텍스트 맵이라 함.

![컨텍스트 맵](https://engineering-skcc.github.io/assets/images/msa/MSA5.10.png)

- 전략적 설계로 도출된 컨텍스트를 기반으로 컨텍스트 매핑 관계를 표현한 개념적인 컨텍스트 맵은 아직 매핑을 위한 구체적인 기술 등이 정의되지 않은 상태.
- 어느 정도 매핑 구현 방안이 정의되면 컨텍스트 맵에 컨텍스트 매핑 유형들을 구체적으로 표현할 수도 있음.
  ![컨텍스트 맵 사례](https://engineering-skcc.github.io/assets/images/msa/MSA5.11.png)
