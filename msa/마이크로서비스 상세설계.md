# 마이크로서비스 상세 설계

## 프런트엔드 모델링

- 웹과 모바일 기술의 발전에 따라 사용자 경험에 민감하게 반응할 수 있는 UI 기술과 개념이 등장했고, 앵귤러(Angular), 리액트(React), 뷰(Vue.js)와 같이 이를 잘 지원하는 프레임워크가 등장함. 위 세 프레임워크는 모두 SPA(Single-Page Application)을 지원.

### 프런트 아키텍처 정의

- 사용자 요건에 적절한 아키텍처를 정의해야 함.
- B2C의 경우 모바일이 이미 웹 만큼이나 대중화되었기 때문에 모바일, 앱, 웹 채널을 모두 고려하 어떤 매체에서나 사용자 경험에 민감하게 반응할 수 있는 반응형 UI를 지향하는 경향이 높아짐.
- 프런트엔드 프레임워크가 정의되면 백엔드 API와 연계되는 스파이크 솔루션(spike solution)을 통해 아키텍처가 사용자 요건을 만족하는지 검토할 필요가 있음.
- 프런트엔드 아키텍처를 수립할 때 프런트엔드 프로그램의 패키지 구조도 정의해야 하는데, 이때 마이크로서비스팀이 책임지고 있는 업무를 고려해서 결정해야 함.
- 마이크로 프런트엔드 패턴을 적용해 백엔드와 마찬가지로 명확히 물리적으로 분리할 수도 있고, 모노리스 구조를 유지한다면 패키지별로 명확히 오너십(ownership)이 구분되게 함.

### 표준 레이아웃 정의

- 시스템의 목적과 기능을 고려해서 화면의 표준 레이아웃을 정의해야 함.
- 보통 비즈니스 처리를 위해 많이 사용되는 목록, 조회, 수정, 삭제 등의 대표적인 업무 화면 유형을 정의하고, 그에 맞는 사용자 경험을 검토해서 정의.
- 표준 화면 유형을 정의할 때 화면을 표현하는 구성요소 등의 위치 및 방식, 모양 등도 고려.
- 구성요소로는 표, 그리드, 입출력 폼, 표준 버튼 등이 존재.
- 화면 유형을 정의할 때 웹, 앱, 모바일, 리포트 등 각 채널 특성에 고유한 화면 유형을 별도로 정의할 수 있음.

### UI레이아웃 설계

- 표준 유형을 기반으로 개별 UI 레이아웃을 정의. 각 기능을 만족할 UI를 정의하는 과정으로서, 화면에 입출력될 속성 정보를 식별하고 기능을 수행할 버튼 등을 정의.
- UI 레이아웃을 정의할 때 업무 흐름에 맞게 UI 흐름이 도출되고 흐름을 보여주는 문서를 작성하기도 하는데, 이를 UI 스토리보드라고 함.

### UI 디자인 및 UI 레이아웃 반영

- 표준 화면 유형에 맞는 UI 디자인을 정의. 웹 디자이너와 프런트엔드 엔지니어간의 긴밀한 협의 필요.
- 마이크로서비스 팀에 디자이너가 속해 있으면 협의가 원활.
- 프런트엔드 엔지니어는 디자이너의 디자인 의도를 반영해 디자인을 적용.

### 이벤트 설계

- 화면의 이벤트 변화에 따라 백엔드 API를 호출하는 방식을 정의.

## 백엔드 모델링

- 백엔드 마이크로서비스를 위한 설계는 헥사고날 아키텍처를 적용해 외부 영역과 내부 영역으로 구분되어 진행됨.
- 이벤트 스토밍 결과를 반영해서 백엔드 마이크로서비스의 내부를 헥사고날 구조로 정의하고 매핑할 수 있으며, 이를 기반으로 발전시켜 나갈 수 있음.
- 이벤트 스토밍의 '커맨드'는 헥사고날 인바운드 어댑터의 하나인 REST-API가 됨.
- '애그리거트'는 헥사코날의 내부 영역인 도메인 모델이 됨.
- '도메인 이벤트'는 헥사고날 외부 영역의 아웃바운드 메시지 처리 어댑터의 대상이 됨.
- '외부 시스템'은 아웃바운드 어댑터가 호출해야 할 외부 연계 시스템으로 매핑됨.
- 이러한 요소는 백엔드 모델링의 출발점이 될 뿐이며, 구현을 위해 좀 더 구체적인 설계 필요. 외부 영역 설계는 프런트엔드와 연계되는 'API 설계'로, 내부 영역은 비즈니스 로직을 구현하는 '도메인 모델링', '데이터 모델링'으로 구체화되어 진행됨.

![이벤트 스토밍 결과와 헥사고날 아키텍처 구성요소 매핑](https://engineering-skcc.github.io/assets/images/msa/MSA5.22.png)

### API 설계

- API 설계는 프런트엔드와 백엔드의 연계를 위한 계약. 백엔드 서비스에 존재하지만 프런트엔드의 요구사항을 충족하도록 정의해야 함.
- API 영역은 헥사고날의 외부 영역이며, 인바운드 어댑터로써 어떠한 호출 방식도 허용되는 유연한 공간.
- 최근 추세는 HTTP 프로토콜과 JSON 포멧을 사용하는 REST API가 표준처럼 사용되고 있음.

### REST API의 개념

- REST(Representational State Transfer) API는 HTTP 프로토콜을 사용하는 대중적으로 광범위한 지지를 얻은 네트워크 기반 아키텍처 스타일.
- 아키텍처를 표현하는 구성요소로 자원(resource), 행위(verb), 표현(representations)가 존재.

```
HTTP POST http://example.com/users/
{
    "users": {
        "name": "홍길동"
    }
}
```

- 위 예시에서 자원은 `http://example.com/users/` 라는 URI로 표현되고, 행위는 HTTP 메서드인 POST, 표현은 JSON 문서의 형태로 전달됨.

### REST API 성숙도

- 레벨 0: REST API의 매커니즘을 전혀 사용하지 않고 전통적인 원격 프로시저 호출(Remote Procedure Call) 방식으로 HTTP프로토콜만 사용한 것. URI 주소에 매개변수로 GET, POST와 같은 메서드를 넘겨서 처리하는 방식
- 레벨 1: URI에 개별적인 자원을 표현하는 것. 여러 기능을 사용하기 위해 하나의 URI에 요청하지 않고 요청이 필요한 대상을 특정함.
- 레벨 2: 서비스의 기능을 처리하기 위해 약속된 HTTP 메서드들을 사용하는 것.
- 레벨 3: HATEOAS(Hypertext As The Engine Of Application State)로 정의되는데, 특정 요청을 하게 되면 반환값에 기대했던 결과에 더불어 추가로 사용자가 그다음에 무엇을 할 수 있는지와 그것을 하기 위해 다룰 수 있는 URI 값을 보내줌. 즉 사용자에게 좀 더 리소스를 탐색해서 활용할 수 있는 가능성을 제공.

![리처드슨의 REST API 성숙도](https://engineering-skcc.github.io/assets/images/msa/MSA5.23.png)

### API 설계 문서화

- API 설계는 프런트엔드 엔지니어와 백엔드 엔지니어의 협업 차원에서 중요.
- 협업 시스템이 있다면 간단한 위키(wiki) 형태의 문서로 작성할 수 있으며, 공식적인 문서 형식이 필요하다면 엑셀 형태로 정리하는 것이 편리
- 최소한 다음 항목은 포함.
  - 서비스명, API명, 리소스(URI)
  - 요청 매개변수, 요청 샘플
  - 응답 매개변수, 응답 샘플

![API 설계서 양식](https://engineering-skcc.github.io/assets/images/msa/MSA5.24.png)
