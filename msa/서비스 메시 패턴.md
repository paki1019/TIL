# 서비스 메시 패턴

- 초창기 MSA 기술인 넷플릭스 OSS나 스프링 클라우드 기반의 서비스를 구축 및 운용할 때의 문제점은 API 게이트웨이, 서비스 레지스트리, 컨피그 서비스와 같이 운영 관리를 위한 여러 개의 기반 서비스를 별도로 각각 만들어야 한다는 번거로움과 더불어, 업무 처리 마이크로서비스에 스프링 클라우드 서비스를 사용하기 위한 라이브러리를 비즈니스 로직과 함께 탑재해야 한다는 단점이 존재함.
- 스프링 클라우드는 자바 기반이기 때문에 마이크로서비스가 자바 외의 다른 언어로 폴리글랏하게 구현된 경우에는 스프링 클라우드 서비스를 아예 사용할 수 없는 문제도 존재.
- 최근에는 MSA 문제 영역 해결을 위한 기능(서비스 탐색, 서킷 브레이크, 추적, 로드 밸런싱 등)을 비즈니스 로직과 분리해서 네트워크 인프라 계층에서 수행하게 하는 서비스 메시(service mesh) 패턴이 선호됨.
  ![서비스 메시](https://engineering-skcc.github.io/assets/images/MSA2.26.png)
- 서비스 메시 패턴의 대표적 구현체 구글 이스티오(Istio)는 애플리케이션이 배포되는 컨테이너에 완전히 격리되어 별도의 컨테이너로 배포되는 사이드카(Sidecar) 패턴을 적용해서 서비스 디스커버리, 라우팅, 로드 밸런싱, 로깅, 모니터링, 보안, 트레이싱 등의 기능을 제공.
- 기본적으로 이스티오는 쿠버네티스에 탑재되어 이러한 서비스 메시 기능을 지원.
- 컨트롤 플레인(Control Plain) 기능에 의해 중앙에서 통제되며, 사이드카끼리의 통신해서 관련 운영 관리 기능을 제공. 이를 통해 마이크로서비스의 비즈니스 로직과는 완전히 독립적으로 운영됨.
  ![서비스 메시의 통신](https://engineering-skcc.github.io/assets/images/MSA2.27.png)
- 쿠버네티스의 컨테이너 단위인 파드(pod)에 서비스 컨테이너와 사이드카 구현체인 엔보이(Envoy) 컨테이너가 함께 배포됨.
- 이스티오는 다음과 같이 스프링 클라우드와 넷플릭스 OSS에서 제공했던 대부분의 기능을 제공하면서 동시에 차별점도 있음.
  - 주요 기능
    - 트래픽 관리(Traffic Management): 동적 라우팅, 로드 밸런싱
    - 보안: 보안 통신 채널(TLS), 인증/인가/암호화
    - 관측성(Observability): 메트릭, 분산 트레이싱, 로깅
  - 스프링 클라우드 및 넷플릭스 OSS와 차별점
    - 애플리케이션 코드의 변경이 거의 없다. 스프링 클라우드나 넷플릭스 OSS 기반은 비즈니스 로직과 함께 코드로 표현되야 하지만 이스티오는 완전히 사이드카로 격리되며 yaml 파일과 같은 설정 파일에 의해 정의됨.
    - 폴리글랏 애플리케이션도 지원함. 스프링 클라우드나 넷플릭스 기반은 자바 언어만 지원하나 이스티오는 각 마이크로서비스를 다른 언어(자바, Node.js C#)로 작성한 경우에도 지원 가능.
    - 이스티오는 쿠버네티스와 완벽하게 통합된 환경을 지원.
