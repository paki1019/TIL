# OSI 7계층과 TCP/IP

## OSI 7계층

과거 통신용 규약이 표준화되어 있지 않았을 시절 호환되지 않는 시스템이나 애플리케이션이 많아 통신에 에러사항이 많았음. 이를 하나의 규약으로 통합한 것이 OSI 7계층.

OSI 7계층이 네트워크의 동작을 나누어 이해하고 개발하는 데 많은 도움이 되므로 네트워크의 주요 레퍼런스 모델로 활용되고 있지만 현재는 대부분 TCP/IP 프로토콜 스택 기반으로 되어 있음.

복잡한 데이터 전송 과정을 OSI 7계층으로 나누어 보면 이해하기가 쉬우며, 계층별로 표준화된 프로토콜 템플릿을 통해 계층별로 프로토콜을 개발해 네트워크 구성 요소들을 모듈화 할 수 있음. 모듈화된 요소는 기존에 개발된 프로토콜과 연동해 사용할 수 있음.

OSI 7계층은 다시 두 계층으로 나눌 수 있음.

- 1~4계층: 데이터 플로 계층(Data Flow Layer) / 하위 계층(Lower Layer)
- 5~7계층: 애플리케이션 계층(Application Layer) / 상위 계층(Upper Layer)

각각의 계층은 각자의 역할과 목표를 가지고 있음. 애플리케이션 개발자는 하향식(Top-Down) 형식으로 네트워크를 바라보고 네트워크 엔지니어는 상향식(Bottom-Up) 형식으로 네트워크를 인식함.

## TCP/IP 프로토콜 스택

현대 네트워크는 대부분 TCP/IP와 이더넷으로 이루어져 있음. TCP/IP는 이론보다 실용성에 중심을 둔 프로토콜.

OSI 레퍼런스 모델은 7계층으로 이루어진 반면, TCP/IP 모델은 4계층으로 구분함. 상위 3개 계층을 하나의 애플리케이션 계층으로 묶고 1,2 물리 계층과 데이터 링크 계층을 하나의 네트워크 계층으로 구분함.

# OSI 7계층별 이해

## 1계층(피지컬 계층)

1계층은 물리 계층으로 물리적 연결과 관련된 정보를 정의함. 주로 전기 신호를 전달하는 데 초점이 맞추어져 있으며, 주요 장비로는 허브(Hub), 리피터(Repeater), 케이블(Cable), 커넥터(Connector), 트랜시버(Tranceiver), 탭(TAP)이 있음. 허브, 리피터는 네트워크 통신을 중재하는 네트워크 장비이고 케이블과 커넥터는 케이블, 트랜시버는 컴퓨터의 랜 카드와 케이블을 연결하는 장치. 탭은 네트워크 모니터링과 패킷 분석을 위해 전기 신호를 다른 장비로 복제해줌.

1계층의 목적은 들어온 전기 신호를 그대로 잘 전달하는 것으로, 1계층 장비에 전기 신호가 들어오면 이 전기 신호를 재생성해서 내보냄. 1계층 장비는 주소의 개념이 없으므로 전기 신호가 들어온 포트를 제외하고 모든 포트에 같은 전기 신호를 전송함.

## 2계층(데이터 링크 계층)

2계층은 데이터 링크 계층으로 전기 신호를 모아 우리가 알아볼 수 있는 데이터 형태로 처리함. 1계층과는 다르게 전기 신호를 정확히 전달하기보다는 주소 정보를 정의하고 정확한 주소로 통신이 되도록 하는 데 초점이 맞추어져 있음. 1계층에서는 전기 신호를 보내는 것이 목적이므로 출발지와 목적지를 구분할 수 없지만 2계층에서는 출발지와 도착지 주소를 확인하고 내게 보낸 것이 맞는지, 또 내가 처리해야 하는지에 대한 검사한 후 데이터 처리를 수행함.

2계층에서는 주소 체계가 생기면서 여러 통신이 한꺼번에 이루어지는 것을 구분하기 위한 기능이 주로 정의됨. 전기 신호를 모아 데이터 형태로 처리하므로 데이터에 대한 에러를 탐지하거나 고치는 역할을 수행할 수 있음. 과거에는 신뢰할 수 없는 미디어를 이용해 통신하는 경우가 많아 2계층에서 에러를 탐지하고 고치거나 재전송했지만 이더넷 기반 네트워크 2계층에서는 에러름 탐지하는 역할만 수행함. 주소 체계가 생기는 것은 한 명과만 통신하는 것이 아니라 동시에 여러 명과 통신할 수도 있다는 것으로 무작정 데이터를 던지는 것이 아니라 받는 사람이 현재 데이터를 받을 수 있는지 확인하는 작업도 해야 함. 이 작업을 플로우 컨트롤(Flow Control)라고 함.

2계층에서 동작하는 네트워크 구성 요소는 네트워크 인터페이스 카드(Network Interface Card)와 스위치. 2계층의 가장 중요한 특징은 MAC주소 라는 주소 체계가 있다는 것. 2계층에서 동작하는 네트워크 인터페이스 카드와 스위치 모두 MAC 주소를 이해할 수 있고 스위치는 MAC 주소를 보고 통신해야 할 포트를 지정해 내보내는 능력이 있음.

네트워크 인터페이스 카드에는 고유 MAC 주소가 존재하며 입력되는 전기 신호를 데이터 형태로 만들고 데이터에서 도착지 MAC 주소를 확인한 후 자신에게 들어오는 전기 신호가 맞는지 확인함. 자신에게 들어오는 전기 신호가 아닌 경우 데이터를 버리고, 맞으면 데이터를 상위 계층에서 처리할 수 있도록 메모리에 적재함.

스위치는 단말(Terminal)이 어떤 MAC 주소인지. 연결된 포트는 어느 것인지 주소 습득(Address Learning) 과정에서 알 수 있음. 이 데이터를 기반으로 단말들이 통신 할 때 포트를 적절히 필터링하고 정확한 포트로 포워딩해줌. 반대로 1계층의 허브는 한 포트에서 전기 신호가 들어오면 모든 다른 포트로 전기 신호를 전달하다 보니 전체 네트워크에서 오직 하나의 장비만 데이터를 보낼 수 있다는 단점이 존재함. 스위치의 적절한 필터링과 포워딩 기능으로 통신이 필요한 포트만 사용하고 네트워크 전체에 불필요한 처리가 감소하면서 이더넷 네트워크 효율성이 크게 향상됨.

> 네트워크 인터페이스 카드를 부르는 방법
>
> 1. 네트워크 인터페이스 카드 또는 네트워크 인터페이스 컨트롤러(Network Interface Controller) 줄여서 NIC 라고도 부름.
> 2. 네트워크 카드(Network Card)라고도 부름.
> 3. 과거 이더넷은 LAN(Local Area Network)에서만 사용되다 보니 랜 카드(Lan Card)라고 부름.
> 4. 물리적으로 컴퓨터의 내부와 외부를 연결해주는 중간 지점이라는 의미로 물리 네트워크 인터페이스라고도 부름.
> 5. 대부분의 네트워크가 이더넷으로 이루어져 있고 이더넷을 연결하는 네트워크 인터페이스 카드를 사용했으므로 이더넷 카드라고도 부름.
> 6. 네트워크 어댑터(Network Adapter)라고 부르기도 함.

### 네트워크 인터페이스 카드 동작 방식

1. 전기 신호를 데이터 형태로 만듬.
2. 목적지 MAC 주소와 출발지 MAC 주소를 확인.
3. 네트워크 인터페이스 카드의 MAC 주소를 확인.
4. 목적지 MAC 주소와 네트워크 인터페이스 카드가 갖고 있는 MAC 주소가 맞으면 데이터를 처리하고 다르면 데이터를 폐기.

## 3계층(네트워크 계층)

3계층에서는 IP 주소와 같은 논리적인 주소가 정의됨. MAC 주소와는 달리 IP 주소는 사용자가 환경에 맞게 변경해 사용할 수 있고 네트워크 주소 부분과 호스트 주소 부분으로 나뉨. 3계층을 이해할 수 있는 장비나 단말은 네트워크 주소 정보를 이용해 자신이 속한 네트워크와 원격지 네트워크를 구분할 수 있고 원격지 네트워크를 가려면 어디로 가야 하는지 경로를 지정하는 능력이 있음.

```
172.31.0.1
// 172.31: 네트워크 부분
// 0.1: 호스트 주소 부분
```

IP 주소는 주소를 나누는 구분점이 3개이며 어디가 네트워크 주소이고 어디가 호스트 주소인지 구분하는 방법은 따로 존재.

3계층에서 동작하는 장비는 라우터. 라우터는 3계층에서 정의한 IP 주소를 이해할 수 있음. 라우터는 IP 주소를 사용해 최적의 경로를 찾아주고 해당 경로로 패킷을 전송하는 역할을 함.

## 4계층(트랜스포트 계층)

4계층은 앞의 1,2,3 계층과는 좀 다른 역할을 함. 하위 4개 계층은 데이터를 잘 쪼개고 받는 역할을 중점적으로 고려하고 네트워크 애플리케이션에서 하위 4계층의 역할을 별도로 고민하지 않도록 도와줌. 하위 1,2,3 계층은 신호와 데이터를 올바른 위치로 보내고 실제 신호를 잘 만들어 보내는 데 집중함.

하지만 4계층은 실제로 해당 데이터들이 정상적으로 보내지도록 확인하는 역할을 함. 패킷 네트워크는 데이터를 분할해 패킷에 실어보내다 보니 중간에 패킷이 유실되거나 순서가 바뀌는 경우가 생길 수 있음. 이 문제를 해결하기 위해 패킷이 유실되거나 순서가 바뀌었을 때 바로잡아 주는 역할을 4계층에서 담당함. 4계층에서 패킷을 분할할 때 패킷 헤더에 보내는 순서와 받는 순서를 적어 통신하므로 패킷이 유실되면 재전송을 요청할 수 있고 순서가 뒤바뀌더라도 바로잡을 수 있음. 패킷에 보내는 순서를 명시한 것이 시퀀스 번호(Sequence Number)이고 받는 순서를 ACK 번호(Acknowledgement Number). 이뿐만 아니라 장치 내의 많은 애플리케이션을 구분할 수 있도록 포트 번호(Port Number)를 사용해 상위 애플리케이션을 구분함.

4계층에서 동작하는 장비로는 로드 밸런서와 방화벽이 있음. 이 장비들은 4계층에서 볼 수 있는 애플리케이션 구분자(포트 번호)와 시퀀스, ACK 번호 정보를 이용해 부하를 분산하거나 보안 정책을 수립해 패킷을 통과, 차단하는 기능을 수행함.

## 5계층(세션 계층)

세션 계층(Session Layer)은 양 끝단의 응용 프로세스가 연결을 성립하도록 도와주고 연결이 안정적으로 유지되도록 관리하고 작업 완료 후에는 이 연결을 끊는 역할을 함. 주로 TCP/IP 세션을 만들고 없애는 책임을 짐. 또한, 에러로 중단된 통신에 대한 에러 복구와 재전송도 수행함.

## 6계층(프레젠테이션 계층)

프레젠테이션 계층(Presentation Layer)은 표현 방식이 다른 애플리케이션이나 시스템 간의 통신을 돕기 위해 하나의 통일된 구문 형식으로 변환시키는 기능을 수행함. 일종의 번역기나 변환기 역할을 수행하는 계층이고 이런 기능은 사용자 시스템의 응용 계층에서 데이터의 형식상 차이를 다루는 부담을 덜어줌. MIME 인코딩이나 암호화, 압축, 코드 변환과 같은 동작이 이 계층에서 이루어짐.

## 7계층(애플리케이션 계층)

애플리케이션 계층(Application Layer)은 애플리케이션 프로세스를 정의하고 애플리케이션 서비스를 수행함. 네트워크 소프트웨어 UI 부분이나 사용자 입출력 부분을 정의하는 것이 애플리케이션 계층의 역할. 대표적인 프로토콜로는 FTP, SMTP, HTTP, TELNET이 존재.
