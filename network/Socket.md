# 소켓(Socket)

## 소켓이란

프로그램이 네트워크에서 데이터를 주고받을 수 있도록 네트워크 환경에 연결할 수 있게 만들어진 연결부.

일반적으로 TCP/IP 프로토콜을 이용.

TCP/IP 4계층에서 전송 계층 위에 놓이며, 전송 계층 위에서 전송계층의 프로토콜 제어를 위한 코드를 제공. 즉 통신의 양끝단에서 입구와 출구 역할을 하는 엔드포인트.

## Socket Programming

프로세스 간 통신에 사용되는 Socket을 이용한 통신 프로그래밍을 socket Programming이라고 함.

Client Socket과 Server Socket로 구분.

통신 연결 요청을 받아들이는 Socket을 Server Socket, 통신 연결 요청을 보내는 Socket을 Client Socket이라고 함.

![Socket Programming](https://velog.velcdn.com/images%2Frhdmstj17%2Fpost%2F323aa1d3-4338-4cfe-9edf-45c1f3113e9d%2Fimage.png)

- 클라이언트: 소켓 생성, 연결 요청, 데이터 송수신, 소켓 닫기
- 서버: 소켓 생성, 결합, 주시, 받아들이기, 데이터 송수신, 소켓 닫기

### 클라이언트 프로세스

#### 1. 클라이언트 소켓 생성

연결 대상에 대한 정보가 들어있지 않은 Socket(껍데기 소켓)을 생성.

이 때 소켓의 종류를 선택해야하는데 TCP 소켓을 위해선 stream 타입을, UDP 소켓을 위해선 데이터그램 타입으로 지정이 가능함.

#### 2. 연결 요청 (Connection)

연결하고 싶은 대상한테 '연결해줘!'라고 요청을 보낸다. IP주소와 서비스 포트 번호로 연결하고 싶은 타켓대상을 특정. 요청을 보내고 단순히 끝나는게 아니고, 그 요청에 대한 결과가 돌아와야만 Connect의 실행.

#### 3. 데이터의 송수신 (Send, Recieve)

연결 요청과 같이, 요청을 보낸다고 끝나는 게 아니라 요청에 대한 결과(신호)가 들어와야 실행이 끝남.

송신할 때에는 데이터를 보내는 것이기 때문에 데이터를 언제 얼마나 보낼것인지 알수 있지만, 수신할 때에는 상대방이 언제, 얼만큼의 데이터를 보낼 것인지 알수가 없다는 서로의 차이점이 존재함. 그렇기 떄문에 수신하는 API는 별도의 Thread에서 진행함.

#### 4. 소켓 닫기

더 이상의 데이터 송수신이 없다고 판단되면 소켓을 닫음.

### 서버 프로세스

#### 1. 서버 소켓 생성

클라이언트 소켓과 마찬가지로 연결 대상에 대한 정보가 들어있지 않은 껍데기 소켓을 생성

#### 2. 바인딩(bind)

서버 소켓이 받은 데이터를 다시 보내주어야할 때 프로세스들의 포트번호가 동일하다면 혼란이 생길 수 있음. 따라서 서버 소켓이 고유한 포트 번호를 만들 수 있도록 소켓과 포트번호를 결합해주는 작업이 필요함.

![바인딩](https://velog.velcdn.com/images%2Frhdmstj17%2Fpost%2Fcab3465b-8897-4a7c-9566-27b0815a876d%2Fimage.png)

운영체제에서는 소켓들이 중복된 포트 번호를 사용하지 않도록, 내부적으로 포트 번호와 소켓 연결 정보를 관리함.

하나의 프로세스는 동일한 포트 번호를 가진 여러 개의 소켓을 결합 할 수 있음. 즉, 호스트가 하나의 Port로 여러 개의 Socket을 만들어 다른 호스트들과 데이터를 주고받을 수 있음.

#### 3. 클라이언트 연결 요청 대기

클라이언트가 연결 요청을 할 때까지 기다리다가 연결 요청이 오면 대기 상태를 종료하고 리턴.

#### 4. 클라이언트 연결 수립

서버 소켓의 메인 역할은 just 클라이언트 연결 요청을 기다리는 것, 따라서 클라이언트 소켓으로부터 연결 요청을 받으면 새로운 소켓을 열고, 이것과 클라이언트 소켓을 맵핑하여 넘겨줌.

#### 5.데이터 송수신 (Send, Recieve)

클라이언트와 동일.

#### 6. 소켓 닫기

클라이언트와 동일. 하지만 서버 소켓은 자신이 생성한 소켓들도 관리를 해야함.

> 출처
>
> - https://velog.io/@rhdmstj17/%EC%86%8C%EC%BC%93%EA%B3%BC-%EC%9B%B9%EC%86%8C%EC%BC%93-%ED%95%9C-%EB%B2%88%EC%97%90-%EC%A0%95%EB%A6%AC-1
