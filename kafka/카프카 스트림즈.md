# 카프카 스트림즈

카프카 스트림즈는 토픽에 적재된 데이터를 상태기반(Stateful) 또는 비상태기반(Stateless)로 실시간 변환하여 다른 토픽에 적재하는 라이브러리. 카프카의 스트림 데이터 처리를 위해 아파치 스파크(Apache Spark), 아파치 플링크(Apache Flink), 아파치 스톰(Apache Storm), 플루언트디(Fluentd)와 같은 다른 오픈소스 애플리케이션도 존재하지만, 카프카 스트림즈는 카프카에서 공식적으로 지원하는 라이브러리이며, 매번 카프카 버전이 오를 때마다 같이 릴리즈 되고, 스트림 처리에 필요한 편리한 기능들(신규 토픽 생성, 상태 저장, 데이터 조인 등)을 제공하기 때문에 제일 적절함. 스트림즈 애플리케이션 또는 카프카 브로커에 장애가 발생하더라도 정확히 한번(exactly once)할 수 있도록 장애 허용 시스템(falut tolerant system)을 가지고 있어서 데이터 처리 안정성이 매우 뛰어남.

스트림즈는 자바 라이브러리로 구현되어 JVM 위에서 하나의 프로세스로 실행되기 때문에, 보통의 빅데이터 처리에 필수적으로 판된되었던 분산 시스템이나 스케줄링 프로그램이 필요없음.

스트림즈 애플리케이션은 내부적으로 1개 이상의 스레드를 생성할 수 있으며, 스레드는 1개 이상의 테스크를 가짐. 테스크(task)는 스트림즈 애플리케이션을 실행하면 생기는 데이터 처리 최소 단위. 만약 3개의 파티션으로 이루어진 토픽을 처리하는 스트림즈 애플리케이션을 실행하면 내부에 3개의 테스크가 생김. 카프카 스트림즈는 컨슈머 스레드를 늘리는 방법과 동일하게 병렬처리를 위해 파티션과 스트림즈 스레드(또는 프로세스) 개수를 늘림으로써 처리량을 늘릴 수 있음.

실제 운영환경에서는 장애가 발생하더라도 안정적으로 운영할 수 있도록 2개 이상의 서버로 구성하여 스트림즈 애플리케이션을 운영함.

토폴로지(topology)는 2개 이상의 노드들과 선으로 이루어진 집합을 뜻하며, 카프카 스트림즈에서 사용하는 토폴로지는 트리 형태와 유사함.

카프카 스트림즈에서 토폴로지를 이루는 노드 하나를 프로세서(processor)라고 부르며 노드와 노드를 이은 선을 스트림(stream)라고 부름. 스트림은 토픽의 데이터를 뜻하는 데 프로듀서와 컨슈머에서 활용했던 레코드와 동일함. 프로세서에는 소스 프로세서, 스트림 프로세서, 싱크 프로세서 3가지가 존재함. 소스 프로세서는 데이터를 처리하기 위해 최초로 선언해야 하는 노드로, 하나 이상의 토픽에서 데이터를 가져오는 역할을 함. 스트림 프로세서는 다른 프로세서가 반환한 데이터를 처리하는 역할을 함. 변환, 분기처리와 같은 로직이 데이터 처리의 일종이라 볼 수 있음. 싱크 프로세서는 데이터를 특정 카프카 토픽으로 저장하는 역할을 하며 스트림즈로 처리된 데이터의 최종 종착지임.
